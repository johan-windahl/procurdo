(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72726,e=>{"use strict";e.s(["default",()=>g],72726);var t=e.i(65830),a=e.i(6943),n=e.i(38510),s=e.i(85770);function l(e){let{value:n,onChange:l}=e,[r,d]=(0,a.useState)(new Set),i=(0,a.useMemo)(()=>{let e=new Map;return s.default.forEach(t=>{e.set(t.code,t)}),e},[]),c=(0,a.useMemo)(()=>s.default.filter(e=>e.code.endsWith("000000")),[]),o=(0,a.useMemo)(()=>e=>{let t=i.get(e);if(t&&t.children&&t.children.length>0)return t.children;let a=s.default,n=[];if(e.endsWith("000000")){let t=e.substring(0,2);n.push(...a.filter(a=>a.code.startsWith(t)&&a.code.endsWith("00000")&&a.code!==e&&8===a.code.length))}else if(e.endsWith("00000")){let t=e.substring(0,3);n.push(...a.filter(a=>a.code.startsWith(t)&&a.code.endsWith("0000")&&a.code!==e&&8===a.code.length))}else if(e.endsWith("0000")){let t=e.substring(0,4);n.push(...a.filter(a=>a.code.startsWith(t)&&a.code.endsWith("000")&&a.code!==e&&8===a.code.length))}else if(e.endsWith("000")){let t=e.substring(0,5);n.push(...a.filter(a=>a.code.startsWith(t)&&a.code!==e&&8===a.code.length&&!a.code.endsWith("000")))}return n},[i]),u=e=>{let a=r.has(e.code),s=o(e.code),i=s.length>0,c=n.includes(e.code);return(0,t.jsxs)("li",{className:"mb-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 p-1 rounded hover:bg-accent/40",children:[i?(0,t.jsx)("button",{type:"button",onClick:t=>{var a;t.stopPropagation(),a=e.code,d(e=>{let t=new Set(e);return t.has(a)?t.delete(a):t.add(a),t})},className:"w-4 h-4 flex items-center justify-center text-muted-foreground hover:text-foreground","aria-expanded":a,children:a?"▼":"▶"}):(0,t.jsx)("div",{className:"w-4"}),(0,t.jsx)("input",{id:"cpv-".concat(e.code),type:"checkbox",checked:c,onChange:t=>((e,t)=>{let a=new Set(n);t?a.add(e.code):a.delete(e.code),l(Array.from(a))})(e,t.target.checked),className:"h-4 w-4"}),(0,t.jsxs)("label",{htmlFor:"cpv-".concat(e.code),className:"text-sm",children:[(0,t.jsx)("span",{className:"font-mono text-muted-foreground mr-2",children:e.code}),e.name]})]}),i&&a?(0,t.jsx)("ul",{className:"mt-1 ml-4",children:s.map(e=>u(e))}):null]},e.code)};return(0,t.jsxs)("div",{className:"rounded-md border bg-card p-3",children:[(0,t.jsxs)("div",{className:"mb-2 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"text-sm font-medium",children:["CPV-koder (",n.length," valda) - ",c.length," kategorier att expandera"]}),n.length>0?(0,t.jsx)("button",{type:"button",onClick:()=>{l([]),d(new Set)},className:"px-3 py-1 text-xs rounded border hover:bg-accent",title:"Rensa alla val",children:"Rensa"}):null]}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(0,t.jsx)("ul",{className:"space-y-1",children:c.map(e=>u(e))})})]})}var r=e.i(64918),d=e.i(66691),i=e.i(92491),c=e.i(73245);let o={cpvs:[],text:"",dateFrom:"",deadlineTo:"",country:"",city:"",status:"ongoing",noticeType:"",valueMin:"",valueMax:""};function u(e){let{onSearch:n,initial:s}=e,[u,m]=(0,a.useState)({...o,...s||{}}),[p,x]=(0,a.useState)(!1),h=e=>m(t=>({...t,...e}));return(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n(u)},className:"rounded-xl border bg-card p-6 space-y-5",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Sökning"}),(0,t.jsx)("input",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u.text,onChange:e=>h({text:e.target.value}),placeholder:"Ex. it, bygg, konsult..."})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Land"}),(0,t.jsxs)("select",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u.country,onChange:e=>h({country:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"Alla"}),r.default.map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("button",{type:"button",onClick:()=>x(e=>!e),className:"text-sm text-muted-foreground hover:text-foreground",children:p?"Dölj avancerade filter":"Visa avancerade filter"}),(0,t.jsx)(d.Button,{type:"submit",size:"lg",children:"Sök"})]}),(0,t.jsxs)("div",{className:(0,i.cn)("space-y-5",p?"block":"hidden"),"aria-hidden":!p,children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"CPV-koder"}),(0,t.jsx)(l,{value:u.cpvs,onChange:e=>h({cpvs:e})})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Publicerad efter"}),(0,t.jsx)("input",{type:"date",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u.dateFrom,onChange:e=>h({dateFrom:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Sista anbudsdag senast"}),(0,t.jsx)("input",{type:"date",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u.deadlineTo||"",onChange:e=>h({deadlineTo:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Ort"}),(0,t.jsx)("input",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u.city,onChange:e=>h({city:e.target.value}),placeholder:"Ex. Stockholm"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Annonstyp"}),(0,t.jsxs)("select",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:u.noticeType||"",onChange:e=>h({noticeType:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"Alla"}),(0,t.jsx)("option",{value:"Contract Notice",children:"Upphandlingsannons"}),(0,t.jsx)("option",{value:"Prior Information Notice",children:"Förhandsannons"}),(0,t.jsx)("option",{value:"Award Notice",children:"Tilldelningsannons"})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Värde (min)"}),(0,t.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9 ]*",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:(0,c.formatThousandsSpaces)(u.valueMin||""),onChange:e=>h({valueMin:(0,c.normalizeNumericInput)(e.target.value)}),placeholder:"10 000"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Värde (max)"}),(0,t.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9 ]*",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:(0,c.formatThousandsSpaces)(u.valueMax||""),onChange:e=>h({valueMax:(0,c.normalizeNumericInput)(e.target.value)}),placeholder:"1 000 000"})]})]})]})]})}let m=e=>e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-");function p(e){let{results:a,page:n,limit:s,total:l,onPage:r}=e,d=Math.max(1,Math.ceil(l/s));return(0,t.jsxs)("div",{className:"mt-8 space-y-6",children:[(0,t.jsx)("ul",{className:"space-y-4",children:a.map(e=>(0,t.jsxs)("li",{className:"rounded-lg border p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold leading-snug",children:e.documentUrl?(0,t.jsx)("a",{href:e.documentUrl,target:"_blank",rel:"noreferrer",className:"hover:underline",children:e.title}):(0,t.jsx)("span",{children:e.title})}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",title:"Publikationsnummer",children:e.publicationNumber})]}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[e.noticeType?(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5",children:function(e){if(!e)return;let t=m(e);return t.startsWith("cn")||t.includes("contract-notice")?"Upphandlingsannons":t.startsWith("can")||t.includes("award-notice")?"Tilldelningsannons":t.startsWith("pin")||t.includes("prior-information")?"Förhandsannons":t.includes("subco")?"Annons om underleverantörer":t.includes("contract-award")?"Tilldelningsannons":e}(e.noticeType)}):null,e.contractNature?(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5",children:function(e){if(!e)return;let t=m(e);return t.includes("services")?"Tjänster":t.includes("works")?"Byggentreprenad":t.includes("supplies")?"Varor":e}(e.contractNature)}):null,e.frameworkAgreement?(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5",children:"Ramavtal"}):null]}),(0,t.jsxs)("div",{className:"mt-3 grid gap-2 text-sm text-muted-foreground md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Köpare:"})," ",e.buyerName]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Plats:"})," ",e.buyerCity," ",e.country]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Publicerad:"})," ",e.publicationDate]}),e.deadlineDate?(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Sista anbudsdag:"})," ",e.deadlineDate]}):null,e.value?(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Värde:"})," ",(()=>{let t=Number(String(e.value).replace(/\s/g,"").replace(/,/g,"."));return Number.isFinite(t)?(0,c.formatThousandsSpaces)(t):e.value})()," ",e.valueCurrency||""]}):null,e.classification?(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"CPV-kod:"})," ",e.classification]}):null,e.procedureType?(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Förfarande:"})," ",function(e){if(!e)return;let t=m(e);return t.includes("neg-w-call")||t.includes("neg")&&t.includes("w-call")?"Förhandlat förfarande med föregående annonsering":t.includes("neg-wo-call")||t.includes("neg-w-o-call")||t.includes("neg-without-call")||t.includes("negotiated-without")?"Förhandlat förfarande utan föregående annonsering":t.includes("open")?"Öppet förfarande":t.includes("restricted")?"Selektivt förfarande":t.includes("competitive-procedure-with-negotiation")?"Konkurrenspräglat förfarande med förhandling":t.includes("competitive-dialogue")?"Konkurrenspräglad dialog":t.includes("innovation-partnership")?"Innovationspartnerskap":t.includes("negotiated")?"Förhandlat förfarande":t.includes("dynamic-purchasing-system")?"Dynamiskt inköpssystem":t.includes("direct-award")||t.includes("directaward")?"Direktupphandling":e}(e.procedureType)]}):null]}),e.description?(0,t.jsx)("p",{className:"mt-3 text-sm text-muted-foreground line-clamp-3",children:e.description}):null]},e.publicationNumber))}),d>1?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,t.jsx)("button",{type:"button",disabled:n<=1,onClick:()=>r(n-1),className:"px-3 py-1 rounded border bg-background disabled:opacity-50",children:"Föregående"}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Sida ",n," av ",d]}),(0,t.jsx)("button",{type:"button",disabled:n>=d,onClick:()=>r(n+1),className:"px-3 py-1 rounded border bg-background disabled:opacity-50",children:"Nästa"})]}):null]})}function x(e){let{size:a=20,className:n,label:s}=e;return(0,t.jsxs)("div",{className:(0,i.cn)("inline-flex items-center gap-2",n),"aria-live":"polite","aria-busy":"true",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full border-2 border-muted-foreground/30 border-t-muted-foreground",style:{width:a,height:a},role:"status","aria-label":s||"Laddar"}),s?(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:s}):null]})}let h={cpvs:[],text:"",dateFrom:"",deadlineTo:"",country:"",city:"",status:"ongoing",noticeType:"",valueMin:"",valueMax:""};function g(){let e=(0,n.useSearchParams)(),s=(0,n.useRouter)(),[l,r]=(0,a.useState)(h),[d,i]=(0,a.useState)([]),[c,o]=(0,a.useState)(1),[m,g]=(0,a.useState)(0),[f,v]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1),[y,N]=(0,a.useState)(null),k=(0,a.useMemo)(()=>{if(!e)return{};let t=e.get("cpv");return{cpvs:t?t.split(",").filter(Boolean):[],text:e.get("q")||"",dateFrom:e.get("from")||"",deadlineTo:e.get("to")||"",country:e.get("country")||"",city:e.get("city")||"",noticeType:e.get("type")||"",valueMin:e.get("min")||"",valueMax:e.get("max")||"",status:e.get("status")||"ongoing"}},[e]);(0,a.useEffect)(()=>{r(e=>({...e,...k})),o(Number((null==e?void 0:e.get("page"))||"1")||1)},[k,e]);let w=(0,a.useCallback)((e,t)=>{let a=new URLSearchParams;e.cpvs.length&&a.set("cpv",e.cpvs.join(",")),e.text&&a.set("q",e.text),e.dateFrom&&a.set("from",e.dateFrom),e.deadlineTo&&a.set("to",e.deadlineTo),e.country&&a.set("country",e.country),e.city&&a.set("city",e.city),e.noticeType&&a.set("type",e.noticeType),e.valueMin&&a.set("min",String(e.valueMin)),e.valueMax&&a.set("max",String(e.valueMax)),e.status&&"ongoing"!==e.status&&a.set("status",e.status),t>1&&a.set("page",String(t));let n=a.toString();s.replace(n?"?".concat(n):"")},[s]),S=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;j(!0),v(!0),N(null),o(t),w(e,t);let a=await fetch("/api/search?page=".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});try{let e=await a.json();if(!a.ok||(null==e?void 0:e.error)){let t=(null==e?void 0:e.unsupportedValue)&&(null==e?void 0:e.parameterName)?" (".concat(e.parameterName,": ").concat(e.unsupportedValue,")"):"";N("".concat((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Ett fel inträffade vid sökning").concat(t)),i([]),g(0);return}i(e.items||[]),g(Number(e.total||0)),t>1&&window.scrollTo({top:0,behavior:"smooth"})}finally{v(!1)}},[w]);return(0,a.useEffect)(()=>{if(e&&e.toString().length>0){let t=Number(e.get("page")||"1")||1;S({...l,...k},t)}},[e]),(0,t.jsxs)("div",{className:"mx-auto max-w-6xl px-4 sm:px-6 py-12",children:[(0,t.jsx)("h1",{className:"text-3xl font-semibold tracking-tight",children:"Hitta upphandlingar och ramavtal gratis"}),(0,t.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Sök och filtrera offentliga upphandlingar och ramavtal. Hitta aktuella upphandlingar med CPV-koder, fritext, datum och plats."}),(0,t.jsx)("div",{className:"mt-8",children:(0,t.jsx)(u,{onSearch:e=>{r(e),S(e,1)},initial:k})}),y?(0,t.jsx)("div",{className:"mt-6 rounded-md border border-destructive/30 bg-destructive/10 p-3 text-sm",children:y}):f?(0,t.jsx)("div",{className:"mt-8 flex justify-center",children:(0,t.jsx)(x,{size:22,label:"Söker upphandlingar..."})}):d.length>0?(0,t.jsx)(p,{results:d,page:c,limit:20,total:m,onPage:e=>S(l,e)}):b?(0,t.jsx)("p",{className:"mt-8 text-sm text-center text-muted-foreground",children:"Inga resultat hittades"}):null]})}}]);