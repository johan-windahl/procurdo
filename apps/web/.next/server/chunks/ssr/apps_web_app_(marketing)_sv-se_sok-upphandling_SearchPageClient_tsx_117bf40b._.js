module.exports=[84440,a=>{"use strict";a.s(["default",()=>q],84440);var b=a.i(69720),c=a.i(29611),d=a.i(2485),e=a.i(85770);function f({value:a,onChange:d}){let[f,g]=(0,c.useState)(new Set),h=(0,c.useMemo)(()=>{let a=new Map;return e.default.forEach(b=>{a.set(b.code,b)}),a},[]),i=(0,c.useMemo)(()=>e.default.filter(a=>a.code.endsWith("000000")),[]),j=(0,c.useMemo)(()=>a=>{let b=h.get(a);if(b&&b.children&&b.children.length>0)return b.children;let c=e.default,d=[];if(a.endsWith("000000")){let b=a.substring(0,2);d.push(...c.filter(c=>c.code.startsWith(b)&&c.code.endsWith("00000")&&c.code!==a&&8===c.code.length))}else if(a.endsWith("00000")){let b=a.substring(0,3);d.push(...c.filter(c=>c.code.startsWith(b)&&c.code.endsWith("0000")&&c.code!==a&&8===c.code.length))}else if(a.endsWith("0000")){let b=a.substring(0,4);d.push(...c.filter(c=>c.code.startsWith(b)&&c.code.endsWith("000")&&c.code!==a&&8===c.code.length))}else if(a.endsWith("000")){let b=a.substring(0,5);d.push(...c.filter(c=>c.code.startsWith(b)&&c.code!==a&&8===c.code.length&&!c.code.endsWith("000")))}return d},[h]),k=c=>{let e=f.has(c.code),h=j(c.code),i=h.length>0,l=a.includes(c.code);return(0,b.jsxs)("li",{className:"mb-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 p-1 rounded hover:bg-accent/40",children:[i?(0,b.jsx)("button",{type:"button",onClick:a=>{var b;a.stopPropagation(),b=c.code,g(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:"w-4 h-4 flex items-center justify-center text-muted-foreground hover:text-foreground","aria-expanded":e,children:e?"▼":"▶"}):(0,b.jsx)("div",{className:"w-4"}),(0,b.jsx)("input",{id:`cpv-${c.code}`,type:"checkbox",checked:l,onChange:b=>((b,c)=>{let e=new Set(a);c?e.add(b.code):e.delete(b.code),d(Array.from(e))})(c,b.target.checked),className:"h-4 w-4"}),(0,b.jsxs)("label",{htmlFor:`cpv-${c.code}`,className:"text-sm",children:[(0,b.jsx)("span",{className:"font-mono text-muted-foreground mr-2",children:c.code}),c.name]})]}),i&&e?(0,b.jsx)("ul",{className:"mt-1 ml-4",children:h.map(a=>k(a))}):null]},c.code)};return(0,b.jsxs)("div",{className:"rounded-md border bg-card p-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"text-sm font-medium",children:["CPV-koder (",a.length," valda) - ",i.length," kategorier att expandera"]}),a.length>0?(0,b.jsx)("button",{type:"button",onClick:()=>{d([]),g(new Set)},className:"px-3 py-1 text-xs rounded border hover:bg-accent",title:"Rensa alla val",children:"Rensa"}):null]}),(0,b.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(0,b.jsx)("ul",{className:"space-y-1",children:i.map(a=>k(a))})})]})}var g=a.i(64918),h=a.i(41487),i=a.i(67636),j=a.i(3136);let k={cpvs:[],text:"",dateFrom:"",deadlineTo:"",country:"",city:"",status:"ongoing",noticeType:"",valueMin:"",valueMax:""};function l({onSearch:a,initial:d}){let[e,l]=(0,c.useState)({...k,...d||{}}),[m,n]=(0,c.useState)(!1),o=a=>l(b=>({...b,...a}));return(0,b.jsxs)("form",{onSubmit:b=>{b.preventDefault(),a(e)},className:"rounded-xl border bg-card p-6 space-y-5",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Sökning"}),(0,b.jsx)("input",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:e.text,onChange:a=>o({text:a.target.value}),placeholder:"Ex. it, bygg, konsult..."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Land"}),(0,b.jsxs)("select",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:e.country,onChange:a=>o({country:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Alla"}),g.default.map(a=>(0,b.jsx)("option",{value:a.code,children:a.name},a.code))]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("button",{type:"button",onClick:()=>n(a=>!a),className:"text-sm text-muted-foreground hover:text-foreground",children:m?"Dölj avancerade filter":"Visa avancerade filter"}),(0,b.jsx)(h.Button,{type:"submit",size:"lg",children:"Sök"})]}),(0,b.jsxs)("div",{className:(0,i.cn)("space-y-5",m?"block":"hidden"),"aria-hidden":!m,children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"CPV-koder"}),(0,b.jsx)(f,{value:e.cpvs,onChange:a=>o({cpvs:a})})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Publicerad efter"}),(0,b.jsx)("input",{type:"date",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:e.dateFrom,onChange:a=>o({dateFrom:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Sista anbudsdag senast"}),(0,b.jsx)("input",{type:"date",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:e.deadlineTo||"",onChange:a=>o({deadlineTo:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Ort"}),(0,b.jsx)("input",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:e.city,onChange:a=>o({city:a.target.value}),placeholder:"Ex. Stockholm"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Annonstyp"}),(0,b.jsxs)("select",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:e.noticeType||"",onChange:a=>o({noticeType:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Alla"}),(0,b.jsx)("option",{value:"Contract Notice",children:"Upphandlingsannons"}),(0,b.jsx)("option",{value:"Prior Information Notice",children:"Förhandsannons"}),(0,b.jsx)("option",{value:"Award Notice",children:"Tilldelningsannons"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Värde (min)"}),(0,b.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9 ]*",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:(0,j.formatThousandsSpaces)(e.valueMin||""),onChange:a=>o({valueMin:(0,j.normalizeNumericInput)(a.target.value)}),placeholder:"10 000"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Värde (max)"}),(0,b.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9 ]*",className:"w-full rounded-md border bg-background px-3 py-2 text-sm",value:(0,j.formatThousandsSpaces)(e.valueMax||""),onChange:a=>o({valueMax:(0,j.normalizeNumericInput)(a.target.value)}),placeholder:"1 000 000"})]})]})]})]})}let m=a=>a.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-");function n({results:a,page:c,limit:d,total:e,onPage:f}){let g=Math.max(1,Math.ceil(e/d));return(0,b.jsxs)("div",{className:"mt-8 space-y-6",children:[(0,b.jsx)("ul",{className:"space-y-4",children:a.map(a=>(0,b.jsxs)("li",{className:"rounded-lg border p-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold leading-snug",children:a.documentUrl?(0,b.jsx)("a",{href:a.documentUrl,target:"_blank",rel:"noreferrer",className:"hover:underline",children:a.title}):(0,b.jsx)("span",{children:a.title})}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",title:"Publikationsnummer",children:a.publicationNumber})]}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[a.noticeType?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5",children:function(a){if(!a)return;let b=m(a);return b.startsWith("cn")||b.includes("contract-notice")?"Upphandlingsannons":b.startsWith("can")||b.includes("award-notice")?"Tilldelningsannons":b.startsWith("pin")||b.includes("prior-information")?"Förhandsannons":b.includes("subco")?"Annons om underleverantörer":b.includes("contract-award")?"Tilldelningsannons":a}(a.noticeType)}):null,a.contractNature?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5",children:function(a){if(!a)return;let b=m(a);return b.includes("services")?"Tjänster":b.includes("works")?"Byggentreprenad":b.includes("supplies")?"Varor":a}(a.contractNature)}):null,a.frameworkAgreement?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5",children:"Ramavtal"}):null]}),(0,b.jsxs)("div",{className:"mt-3 grid gap-2 text-sm text-muted-foreground md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Köpare:"})," ",a.buyerName]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Plats:"})," ",a.buyerCity," ",a.country]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Publicerad:"})," ",a.publicationDate]}),a.deadlineDate?(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Sista anbudsdag:"})," ",a.deadlineDate]}):null,a.value?(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Värde:"})," ",(()=>{let b=Number(String(a.value).replace(/\s/g,"").replace(/,/g,"."));return Number.isFinite(b)?(0,j.formatThousandsSpaces)(b):a.value})()," ",a.valueCurrency||""]}):null,a.classification?(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"CPV-kod:"})," ",a.classification]}):null,a.procedureType?(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Förfarande:"})," ",function(a){if(!a)return;let b=m(a);return b.includes("neg-w-call")||b.includes("neg")&&b.includes("w-call")?"Förhandlat förfarande med föregående annonsering":b.includes("neg-wo-call")||b.includes("neg-w-o-call")||b.includes("neg-without-call")||b.includes("negotiated-without")?"Förhandlat förfarande utan föregående annonsering":b.includes("open")?"Öppet förfarande":b.includes("restricted")?"Selektivt förfarande":b.includes("competitive-procedure-with-negotiation")?"Konkurrenspräglat förfarande med förhandling":b.includes("competitive-dialogue")?"Konkurrenspräglad dialog":b.includes("innovation-partnership")?"Innovationspartnerskap":b.includes("negotiated")?"Förhandlat förfarande":b.includes("dynamic-purchasing-system")?"Dynamiskt inköpssystem":b.includes("direct-award")||b.includes("directaward")?"Direktupphandling":a}(a.procedureType)]}):null]}),a.description?(0,b.jsx)("p",{className:"mt-3 text-sm text-muted-foreground line-clamp-3",children:a.description}):null]},a.publicationNumber))}),g>1?(0,b.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,b.jsx)("button",{type:"button",disabled:c<=1,onClick:()=>f(c-1),className:"px-3 py-1 rounded border bg-background disabled:opacity-50",children:"Föregående"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Sida ",c," av ",g]}),(0,b.jsx)("button",{type:"button",disabled:c>=g,onClick:()=>f(c+1),className:"px-3 py-1 rounded border bg-background disabled:opacity-50",children:"Nästa"})]}):null]})}function o({size:a=20,className:c,label:d}){return(0,b.jsxs)("div",{className:(0,i.cn)("inline-flex items-center gap-2",c),"aria-live":"polite","aria-busy":"true",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full border-2 border-muted-foreground/30 border-t-muted-foreground",style:{width:a,height:a},role:"status","aria-label":d||"Laddar"}),d?(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:d}):null]})}let p={cpvs:[],text:"",dateFrom:"",deadlineTo:"",country:"",city:"",status:"ongoing",noticeType:"",valueMin:"",valueMax:""};function q(){let a=(0,d.useSearchParams)(),e=(0,d.useRouter)(),[f,g]=(0,c.useState)(p),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(1),[m,q]=(0,c.useState)(0),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),x=(0,c.useMemo)(()=>{if(!a)return{};let b=a.get("cpv");return{cpvs:b?b.split(",").filter(Boolean):[],text:a.get("q")||"",dateFrom:a.get("from")||"",deadlineTo:a.get("to")||"",country:a.get("country")||"",city:a.get("city")||"",noticeType:a.get("type")||"",valueMin:a.get("min")||"",valueMax:a.get("max")||"",status:a.get("status")||"ongoing"}},[a]);(0,c.useEffect)(()=>{g(a=>({...a,...x})),k(Number(a?.get("page")||"1")||1)},[x,a]);let y=(0,c.useCallback)((a,b)=>{let c=new URLSearchParams;a.cpvs.length&&c.set("cpv",a.cpvs.join(",")),a.text&&c.set("q",a.text),a.dateFrom&&c.set("from",a.dateFrom),a.deadlineTo&&c.set("to",a.deadlineTo),a.country&&c.set("country",a.country),a.city&&c.set("city",a.city),a.noticeType&&c.set("type",a.noticeType),a.valueMin&&c.set("min",String(a.valueMin)),a.valueMax&&c.set("max",String(a.valueMax)),a.status&&"ongoing"!==a.status&&c.set("status",a.status),b>1&&c.set("page",String(b));let d=c.toString();e.replace(d?`?${d}`:"")},[e]),z=(0,c.useCallback)(async(a,b=1)=>{u(!0),s(!0),w(null),k(b),y(a,b);let c=await fetch(`/api/search?page=${b}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});try{let a=await c.json();if(!c.ok||a?.error){let b=a?.unsupportedValue&&a?.parameterName?` (${a.parameterName}: ${a.unsupportedValue})`:"";w(`${a?.message||a?.error||"Ett fel inträffade vid sökning"}${b}`),i([]),q(0);return}i(a.items||[]),q(Number(a.total||0)),b>1&&window.scrollTo({top:0,behavior:"smooth"})}finally{s(!1)}},[y]);return(0,c.useEffect)(()=>{if(a&&a.toString().length>0){let b=Number(a.get("page")||"1")||1;z({...f,...x},b)}},[a]),(0,b.jsxs)("div",{className:"mx-auto max-w-6xl px-4 sm:px-6 py-12",children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold tracking-tight",children:"Hitta upphandlingar och ramavtal gratis"}),(0,b.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Sök och filtrera offentliga upphandlingar och ramavtal. Hitta aktuella upphandlingar med CPV-koder, fritext, datum och plats."}),(0,b.jsx)("div",{className:"mt-8",children:(0,b.jsx)(l,{onSearch:a=>{g(a),z(a,1)},initial:x})}),v?(0,b.jsx)("div",{className:"mt-6 rounded-md border border-destructive/30 bg-destructive/10 p-3 text-sm",children:v}):r?(0,b.jsx)("div",{className:"mt-8 flex justify-center",children:(0,b.jsx)(o,{size:22,label:"Söker upphandlingar..."})}):h.length>0?(0,b.jsx)(n,{results:h,page:j,limit:20,total:m,onPage:a=>z(f,a)}):t?(0,b.jsx)("p",{className:"mt-8 text-sm text-center text-muted-foreground",children:"Inga resultat hittades"}):null]})}}];

//# sourceMappingURL=apps_web_app_%28marketing%29_sv-se_sok-upphandling_SearchPageClient_tsx_117bf40b._.js.map